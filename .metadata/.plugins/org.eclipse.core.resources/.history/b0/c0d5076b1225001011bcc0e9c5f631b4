<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<%@ taglib uri="http://java.sun.com/jstl/core_rt" prefix="c" %>
<%@ taglib uri="http://java.sun.com/jsp/jstl/functions" prefix="fn" %>
<%@ taglib uri="http://java.sun.com/jsp/jstl/fmt" prefix="fmt" %>
<%@ taglib prefix="custom" uri="http://example.com/custom" %>

<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Home</title>
	<base href="${pageContext.servletContext.contextPath}/">
	<link rel="icon" type="images/png" href="images/logocinema.png">
	<!--	Khai b√°o css, boostrap -->
	<link href="css/bootstrap.min.css" rel="stylesheet" >
	<link href="css/font-awesome.min.css" rel="stylesheet" >
	<link href="css/global.css" rel="stylesheet">
	<link href="css/index.css" rel="stylesheet">
	<link href="css/all.css" rel="stylesheet">
	<link href="css/add_home.css" rel="stylesheet">
	<link href="css/chatbot.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
	<link href="https://fonts.googleapis.com/css2?family=Rajdhani&display=swap" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.1/font/bootstrap-icons.css">
	<script src="js/bootstrap.bundle.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/lightbox2@2.11.3/dist/css/lightbox.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/lightbox2@2.11.3/dist/js/lightbox.min.js"></script>
</head>
<body>
	<!-- 	Ph·∫ßn ƒë·∫ßu -->
	<section id="top">
		<div class="container">
			 <div class="row top_1">
			 	<div class="col-md-3">
 				   <div class="top_1l pt-1">
		    			<h3 class="mb-0"><a class="text-white" href=""><i class="fa fa-video-camera col_red me-1"></i>Tu Tru Cinema</a></h3>
		   			</div>
			 	</div>
			 	<div class="col-md-5">
   	 				<div class="top_1m">
    					<form class="col-12 col-lg-auto mb-3 mb-lg-0 me-lg-3" action="/DoAnWebCinema/search.htm">
							<input type="search" class="form-control form-control-dark" placeholder="Search..." aria-label="Search" name="search">
						</form>
        			</div>
    			</div>
				<div class="col-md-4">
				    <div class="top_1r text-end mt-1">
				        <c:choose>
				            <c:when test="${user.tenKH != null}">
				                <p><i class="bi bi-person-circle"></i><span> </span><a href="customer/account.htm"><strong>${user.tenKH}</strong></a></p>
				            </c:when>
				            <c:otherwise>
				                <div>
				                    <i class="bi bi-person-circle"></i>
				                    <a href="login.htm"><b>Login</b></a>
				                    <a href="register.htm"><b>Sign Up</b></a>
				                </div>
				            </c:otherwise>
				        </c:choose>
				    </div>
				</div>
			 </div>
		</div>
	</section>
	<!-- 	Ph·∫ßn Menu -->
	<section id="header">
		<nav class="navbar navbar-expand-md navbar-light" id="navbar_sticky">
			<div class="container">
				<a class="navbar-brand text-white fw-bold" href=""><i class="fa fa-video-camera col_red me-1"></i>TU TRU CINEMA</a>
				    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
				    <span class="navbar-toggler-icon"></span>
			    </button>
    			<div class="collapse navbar-collapse" id="navbarSupportedContent">
					<ul class="navbar-nav mb-0">
			        	<li class="nav-item">
			          		<a class="nav-link active" aria-current="page" href="trangchu.htm">Home</a>
			        	</li>
			     		<li class="nav-item">
			          		<a id="dat-ve-link" class="nav-link" href="#">Book Now</a>
			        	</li>
			        	<li class="nav-item dropdown">
			          		<a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">Movie</a>
			          		<ul class="dropdown-menu drop_1" aria-labelledby="navbarDropdown">
						    	<li><a class="dropdown-item" href="phimsapchieu.htm?tab=home">Now Showing</a></li>
						    	<li><a class="dropdown-item border-0" href="phimsapchieu.htm?tab=profile">Coming Soon</a></li>
			          		</ul>
			        	</li>
						<li class="nav-item">
			          		<a class="nav-link" href="gioithieu.htm">About Us</a>
		        		</li>
						<li class="nav-item">
			          		<a class="nav-link" href="lienhe.htm">Contact</a>
			        	</li>
			      	</ul>
				</div>
			</div>
		</nav>
	</section>
	<!-- 	Ph·∫ßn banner, 3 phim c√≥ ƒëi·ªÉm ƒë√°nh gi√° cao nh·∫•t -->
	<section id="center" class="center_home">
		<div id="carouselExampleCaptions" class="carousel slide" data-bs-ride="carousel">
		  	<div class="carousel-indicators">
			    <button type="button" data-bs-target="#carouselExampleCaptions" data-bs-slide-to="0" class="active" aria-label="Slide 1"></button>
			    <button type="button" data-bs-target="#carouselExampleCaptions" data-bs-slide-to="1" aria-label="Slide 2" class="" aria-current="true"></button>
			    <button type="button" data-bs-target="#carouselExampleCaptions" data-bs-slide-to="2" aria-label="Slide 3"></button>
		  	</div>
		  	<div class="carousel-inner">
    			<c:forEach var="phim" items="${phimListHot}" varStatus="status" begin="0" end="2">
        			<div class="carousel-item ${status.index == 0 ? 'active' : ''}">
            			<img src="/DoAnWebCinema/uploads/${phim.linkAnh}" class="d-block w-100" alt="...">
            			<div class="carousel-caption d-md-block">
                			<h1 class="font_60">${phim.getTenPhim()}</h1>
              			    <h6 class="mt-3">
            					<c:choose>
            						<c:when test="${phim.getDiem() == null}">
							            <span class="col_red me-3">No reviews yet</span>
							        </c:when>
									<c:when test="${phim.getDiem() < 1}">
                    					<span class="col_red me-3">
                       						<i class="fa fa-star-half-o"></i>                  					
                       					</span>
									</c:when>
									<c:when test="${phim.getDiem() < 2}">
                   						<span class="col_red me-3">
                        					<i class="fa fa-star"></i>
                    					</span>
									</c:when>
									<c:when test="${phim.getDiem() < 3}">
                   						<span class="col_red me-3">
                        					<i class="fa fa-star"></i>
                        					<i class="fa fa-star"></i>
                    					</span>
									</c:when>
									<c:when test="${phim.getDiem() < 4}">
                   						<span class="col_red me-3">
                        					<i class="fa fa-star"></i>
                        					<i class="fa fa-star"></i>
                        					<i class="fa fa-star"></i>
                    					</span>
									</c:when>
									<c:when test="${phim.getDiem() < 4.5}">
                   						<span class="col_red me-3">
                        					<i class="fa fa-star"></i>
                        					<i class="fa fa-star"></i>
                        					<i class="fa fa-star"></i>
                        					<i class="fa fa-star"></i>
                    					</span>
									</c:when>
									<c:when test="${phim.getDiem() < 5}">
                   						<span class="col_red me-3">
                        					<i class="fa fa-star"></i>
                        					<i class="fa fa-star"></i>
                        					<i class="fa fa-star"></i>
                        					<i class="fa fa-star"></i>
                        					<i class="fa fa-star-half-o"></i> 
                    					</span>
									</c:when>
									<c:otherwise>
					                    <span class="col_red me-3">
					                        <i class="fa fa-star"></i>
					                        <i class="fa fa-star"></i>
					                        <i class="fa fa-star"></i>
					                        <i class="fa fa-star"></i>
					                        <i class="fa fa-star"></i>
					                    </span>
									</c:otherwise>
								</c:choose>
                   			    <c:if test="${phim.getDiem() != null}">
							        ${phim.getDiem()}/5 (Rate)
							    </c:if>		Year : ${phim.getNamSX()}
                    			<a class="bg_red p-2 pe-4 ps-4 ms-3 text-white d-inline-block" href="/DoAnWebCinema/film/detail/${phim.maPhim}.htm">Details</a>
                			</h6>
                			<p class="mt-3">${phim.getMoTa()}</p>
                			<p class="mb-2"><span class="col_red me-1 fw-bold">Director:</span>${phim.getDaoDien().getTenDaoDien()}</p>
             				<p class="mb-2"><span class="col_red me-1 fw-bold">Cast :</span>
							    <c:if test="${not empty phim.vaiDiens}">
							        <c:forEach var="chiTietdienvien" items="${phim.vaiDiens}" varStatus="status">
							            <c:out value="${chiTietdienvien.getDienVien().tenDienVien}" />
							            <c:if test="${!status.last}">, </c:if>
							        </c:forEach>
							    </c:if>
							</p>
							<p class="mb-2"><span class="col_red me-1 fw-bold">Genre:</span>
							    <c:if test="${not empty phim.chiTietTheLoais}">
							        <c:forEach var="chiTiet" items="${phim.chiTietTheLoais}" varStatus="status">
							            <c:out value="${chiTiet.theLoai.tenTL}" />
							            <c:if test="${!status.last}">, </c:if>
							        </c:forEach>
							    </c:if>
							</p>
							<p><span class="col_red me-1 fw-bold">Duration:</span> ${phim.getThoiLuong()}m</p>
							<h6 class="mt-4">
			                	<a class="button" href="javascript:void(0)" onclick="openLightbox('${phim.getLinkTrailer()}', 'lightbox-${status.index}', 'lightbox-video-${status.index}')"><i class="fa fa-play-circle align-middle me-1"></i>Watch Trailer</a>
			                </h6>
			                <!-- Lightbox v·ªõi ID ri√™ng cho m·ªói phim -->
                            <div id="lightbox-${status.index}" style="display:none; position:fixed; z-index:999; left:0; top:0; width:100%; height:100%; background-color:rgba(0,0,0,0.8); justify-content:center; align-items:center;">
                                <div style="position:relative; width:80%; max-width:800px;">
                                    <span onclick="closeLightbox('lightbox-${status.index}', 'lightbox-video-${status.index}')" style="position:absolute; top:10px; right:20px; color:white; font-size:30px; cursor:pointer;">&times;</span>
                                    <iframe id="lightbox-video-${status.index}" width="100%" height="450px" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
                                </div>
                            </div>
            		    </div>
          			</div>
    			</c:forEach>
			</div>
			<button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleCaptions" data-bs-slide="prev">
			    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
			    <span class="visually-hidden">Previous</span>
			 </button>
			 <button class="carousel-control-next" type="button" data-bs-target="#carouselExampleCaptions" data-bs-slide="next">
			    <span class="carousel-control-next-icon" aria-hidden="true"></span>
			    <span class="visually-hidden">Next</span>
			  </button>
		</div>
	</section>
	<!-- 	Phim m·ªõi nh·∫•t -->
	<section id="trend" class="pt-4 pb-5">
		<div class="container">
			<div class="row trend_1">
	            <div class="col-md-6 col-6">
	                <div class="trend_1l">
	                    <h4 class="mb-0">
	                        <i class="fa fa-youtube-play align-middle col_red me-1"></i>
	                        <span class="col_red">Latest</span> Movie
	                    </h4>
	                </div>
	            </div>
	        </div>
	        <div class="row trend_2 mt-4">
	        	<div id="carouselExampleCaptions1" class="carousel slide" data-bs-ride="carousel">
	        		<div class="carousel-indicators">
			            <button type="button" data-bs-target="#carouselExampleCaptions1" data-bs-slide-to="0" class="active" aria-label="Slide 1"></button>
			            <button type="button" data-bs-target="#carouselExampleCaptions1" data-bs-slide-to="1" aria-label="Slide 2"></button>
			        </div>
			        <div class="carousel-inner">
			        	<c:forEach var="phim" items="${phimListNew}" varStatus="status" begin="0" end="5">
			            	<c:if test="${status.index % 3 == 0}">
                    			<div class="carousel-item ${status.index == 0 ? 'active' : ''}">
                        			<div class="trend_2i row">
                			</c:if>
                			<div class="col-md-4">
                                <!-- Hi·ªÉn th·ªã ·∫£nh v√† n√∫t ƒë·ªÉ m·ªü lightbox -->
                                <div class="trend_2im clearfix position-relative">
                                    <div class="trend_2im1 clearfix">
                                        <div class="grid">
                                            <figure class="effect-jazz mb-0">
                                                <!-- S·ª≠ d·ª•ng ch·ªâ s·ªë phim ƒë·ªÉ t·∫°o ID ri√™ng -->
                                                <a href="javascript:void(0)" onclick="openLightbox('${phim.getLinkTrailer()}', 'lightbox-${status.index}', 'lightbox-video-${status.index}')">
                                                    <img src="/DoAnWebCinema/uploads/${phim.linkAnh}" class="w-100" alt="${phim.getTenPhim()}">
                                                </a>
                                            </figure>
                                        </div>
                                    </div>
                                    <div class="trend_2im2 clearfix text-center position-absolute w-100 top-0">
                                        <span class="fs-1">
                                            <!-- S·ª≠ d·ª•ng ch·ªâ s·ªë phim ƒë·ªÉ t·∫°o ID ri√™ng -->
                                            <a class="col_red" href="javascript:void(0)" onclick="openLightbox('${phim.getLinkTrailer()}', 'lightbox-${status.index}', 'lightbox-video-${status.index}')">
                                                <i class="fa fa-youtube-play"></i>
                                            </a>
                                        </span>
                                    </div>
                                </div>
                                <!-- Lightbox v·ªõi ID ri√™ng cho m·ªói phim -->
                                <div id="lightbox-${status.index}" style="display:none; position:fixed; z-index:999; left:0; top:0; width:100%; height:100%; background-color:rgba(0,0,0,0.8); justify-content:center; align-items:center;">
                                    <div style="position:relative; width:80%; max-width:800px;">
                                        <span onclick="closeLightbox('lightbox-${status.index}', 'lightbox-video-${status.index}')" style="position:absolute; top:10px; right:20px; color:white; font-size:30px; cursor:pointer;">&times;</span>
                                        <iframe id="lightbox-video-${status.index}" width="100%" height="450px" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
                                    </div>
                                </div>
                                <div class="trend_2ilast bg_grey p-3 clearfix">
                                    <h5><a class="col_red" href="#">${phim.getTenPhim()}</a></h5>
                                    <p class="mb-2">
                                        <c:set var="substringResult" value="${custom:safeSubstring(phim.getMoTa(), 100)}" />
                                        ${substringResult}...<a href = "/DoAnWebCinema/film/detail/${phim.maPhim}.htm"><b>[View Details]</b></a>
                                    </p>
                                    <c:choose>
                                    	<c:when test="${phim.getMaTT() == 1}">
                                    		<b><p style="color: gray;">Now Playing in Theaters</p></b>
                                    	</c:when>
                                    	<c:when test="${phim.getMaTT() == 2}">
                                    		<b><p style="color: gray;">Upcoming Release <fmt:formatDate value="${phim.ngayKhoiChieu}" pattern="dd/MM/yyyy" /></p></b>
                                    	</c:when>
                                    	<c:when test="${phim.getMaTT() == 0}">
                                    		<b><p style="color: gray;">Ended Showing</p></b>
                                    	</c:when>
                                    </c:choose>
                                    <span class="col_red">
                                        <c:choose>
                                        	<c:when test="${phim.getDiem() == null}">
									            <span class="col_red me-3">No ratings yet</span>
									        </c:when>
											<c:when test="${phim.getDiem() < 1}">
		                    					<span class="col_red me-3">
		                       						<i class="fa fa-star-half-o"></i>                  					
		                       					</span>
											</c:when>
											<c:when test="${phim.getDiem() < 2}">
		                   						<span class="col_red me-3">
		                        					<i class="fa fa-star"></i>
		                    					</span>
											</c:when>
											<c:when test="${phim.getDiem() < 3}">
		                   						<span class="col_red me-3">
		                        					<i class="fa fa-star"></i>
		                        					<i class="fa fa-star"></i>
		                    					</span>
											</c:when>
											<c:when test="${phim.getDiem() < 4}">
		                   						<span class="col_red me-3">
		                        					<i class="fa fa-star"></i>
		                        					<i class="fa fa-star"></i>
		                        					<i class="fa fa-star"></i>
		                    					</span>
											</c:when>
											<c:when test="${phim.getDiem() < 4.5}">
		                   						<span class="col_red me-3">
		                        					<i class="fa fa-star"></i>
		                        					<i class="fa fa-star"></i>
		                        					<i class="fa fa-star"></i>
		                        					<i class="fa fa-star"></i>
		                    					</span>
											</c:when>
											<c:when test="${phim.getDiem() < 5}">
		                   						<span class="col_red me-3">
		                        					<i class="fa fa-star"></i>
		                        					<i class="fa fa-star"></i>
		                        					<i class="fa fa-star"></i>
		                        					<i class="fa fa-star"></i>
		                        					<i class="fa fa-star-half-o"></i> 
		                    					</span>
											</c:when>
											<c:otherwise>
							                    <span class="col_red me-3">
							                        <i class="fa fa-star"></i>
							                        <i class="fa fa-star"></i>
							                        <i class="fa fa-star"></i>
							                        <i class="fa fa-star"></i>
							                        <i class="fa fa-star"></i>
							                    </span>
											</c:otherwise>
										</c:choose>
                                    </span>		    
	                                    <c:if test="${phim.getDiem() != null}">
								        	${phim.getDiem()}/5 (Rate)
								    	</c:if>
                                </div>
                            </div>
                			<c:if test="${status.index % 3 == 2 || status.last}">
                        			</div>
                    			</div>
                			</c:if>
			        	</c:forEach>
			        </div>
	        	</div>
	        </div>
		</div>
	</section>
	
	<section id="upcome" class="pt-4 pb-5">
	<div class="container">
		<div class="row trend_1">
	  		<div class="col-md-6 col-6">
	   			<div class="trend_1l">
	    			<h4 class="mb-0"><i class="fa fa-youtube-play align-middle col_red me-1"></i><span class="col_red">   Featured</span> Events</h4>
	   			</div>
	  		</div>
		 </div>
		 <div class="row trend_2 mt-4">
		    <div id="carouselExampleCaptions1" class="carousel slide" data-bs-ride="carousel">
		    	<div class="carousel-indicators">
				    <button type="button" data-bs-target="#carouselExampleCaptions1" data-bs-slide-to="0" class="active" aria-label="Slide 1"></button>
				    <button type="button" data-bs-target="#carouselExampleCaptions1" data-bs-slide-to="1" aria-label="Slide 2" class="" aria-current="true"></button>
		  		</div>
		  		<div class="carousel-inner">
				    <c:forEach var="sukien" items="${sukienList}" varStatus="status" begin="0" end="5">
				        <c:if test="${status.index % 3 == 0}">
				            <div class="carousel-item ${status.index == 0 ? 'active' : ''}">
				                <div class="trend_2i row">
				        </c:if>
				                    <div class="col-md-4">
				                        <div class="trend_2im clearfix position-relative">
				                            <div class="trend_2im1 clearfix">
				                                <div class="grid">
													<figure class="effect-jazz mb-0">
													    <a href="${sukien.getPosterSK()}" data-lightbox="image-1" data-title="${sukien.getTenSK()}">
													        <img src="${sukien.getPosterSK()}" class="w-100" alt="${sukien.getTenSK()}">
													    </a>
													</figure>
				                                </div>
				                            </div>
				                        </div>
				                        <div class="trend_2ilast bg_grey p-3 clearfix">
				                            <h5>
				                                <a class="col_red" href="#">${sukien.getTenSK()}</a>
				                            </h5>
				                            <p class="mb-2">
				                                <c:set var="substringResult" value="${custom:safeSubstring(sukien.getMoTaSK(), 50)}" />
				                                <p>${substringResult}... <a href = "sukienDetail.htm?id=${sukien.maSK}"><b>[See More]</b></a></p>
				                            </p>
				                        </div>
				                    </div>
				        <c:if test="${status.index % 3 == 2 || status.last}">
				                </div>
				            </div>
				        </c:if>
				    </c:forEach>
				</div>
			</div>
</section>

<section id="movie-section" class="movie-section">
    <div class="container">
        <div class="movie-header">
            <div class="header-title">
                <h4><i class="fa fa-youtube-play movie-icon"></i> Movie <span class="highlight">Categories</span></h4>
            </div>
            <div class="header-link">
                <a href="phim/phimsapchieu.htm?tab=home" class="view-all-btn">View All</a>
            </div>
        </div>
        <div class="movie-tabs">
            <ul class="nav nav-tabs">
                <li class="nav-item">
                    <a class="nav-link active" data-bs-toggle="tab" href="#now-showing">Now Showing</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" data-bs-toggle="tab" href="#coming-soon">Coming Soon</a>
                </li>
            </ul>
        </div>
        <div class="tab-content movie-content">
            <!-- Now Showing -->
            <div class="tab-pane fade show active" id="now-showing">
                <div class="movie-grid">
                    <c:forEach var="phim" items="${phimListDangChieu}" varStatus="status" begin="0" end="3">
                        <div class="movie-card">
                            <div class="movie-poster">
                                <a href="/DoAnWebCinema/uploads/${phim.linkAnh}" data-lightbox="movie-gallery" data-title="${phim.getTenPhim()}">
                                    <img src="/DoAnWebCinema/uploads/${phim.linkAnh}" alt="${phim.getTenPhim()}">
                                </a>
                            </div>
                            <div class="movie-info">
                                <h4 class="movie-title">${phim.getTenPhim()}</h4>
                                <div class="movie-meta">
                                    <span><i class="fa fa-star"></i> ${phim.getDiem()}/10 IMDb</span>
                                    <span>Year: ${phim.getNamSX()}</span>
                                    <span>Duration: ${phim.getThoiLuong()}m</span>
                                </div>
                                <p class="movie-description">${phim.getMoTa()}</p>
					          <div class="d-flex justify-content-between flex-wrap gap-2 mt-2">
							    <a href="/DoAnWebCinema/datve/${currentDate}.htm" class="book-btn">Book Now</a>
							    <a href="/DoAnWebCinema/film/detail/${phim.maPhim}.htm" class="trailer-btn">
							        <i class="fa fa-info-circle"></i> Details
							    </a>
							</div>
                            </div>
                        </div>
                    </c:forEach>
                </div>
            </div>
            <!-- Coming Soon -->
            <div class="tab-pane fade" id="coming-soon">
                <div class="movie-grid">
                    <c:forEach var="phim" items="${phimListSapChieu}" varStatus="status" begin="0" end="3">
                        <div class="movie-card">
                            <div class="movie-poster">
                                <a href="/DoAnWebCinema/uploads/${phim.linkAnh}" data-lightbox="movie-gallery" data-title="${phim.getTenPhim()}">
                                    <img src="/DoAnWebCinema/uploads/${phim.linkAnh}" alt="${phim.getTenPhim()}">
                                </a>
                            </div>
                            <div class="movie-info">
                                <h4 class="movie-title">${phim.getTenPhim()}</h4>
                                <div class="movie-meta">
                                    <span><i class="fa fa-star"></i> ${phim.getDiem()}/10 IMDb</span>
                                    <span>Year: ${phim.getNamSX()}</span>
                                    <span>Duration: ${phim.getThoiLuong()}m</span>
                                </div>
                                <p class="movie-description">${phim.getMoTa()}</p>
                                <b class="release-date">Release: ${phim.getNgayKhoiChieu()}</b>
      <div class="d-flex justify-content-between flex-wrap gap-2 mt-2">
    <div>
        <a href="javascript:void(0)" onclick="openLightbox('${phim.getLinkTrailer()}', 'lightbox-${status.index}', 'lightbox-video-${status.index}')" class="trailer-btn me-2">
            <i class="fa fa-play-circle"></i> Watch Trailer
        </a>
        <a href="/DoAnWebCinema/film/detail/${phim.maPhim}.htm" class="trailer-btn">
            <i class="fa fa-info-circle"></i> Details
        </a>
    </div>
</div>

                                <div id="lightbox-${status.index}" class="lightbox">
                                    <div class="lightbox-content">
                                        <span onclick="closeLightbox('lightbox-${status.index}', 'lightbox-video-${status.index}')" class="lightbox-close">&times;</span>
                                        <iframe id="lightbox-video-${status.index}" width="100%" height="450" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </c:forEach>
                </div>
            </div>
        </div>
    </div>
</section>

<section id="play">
<div class="play_m clearfix">
 <div class="container">
 <div class="row trend_1">
  <div class="col-md-12">
   <div class="trend_1l">
    <h4 class="mb-0"><i class="fa fa-youtube-play align-middle col_red me-1"></i> Top <span class="col_red">#1</span></h4>
   </div>
  </div>
 </div>
 <div class="play2 row mt-4">
  <div class="col-md-4 p-0">
   <div class="play2l">
<div class="grid clearfix">
    <figure class="effect-jazz mb-0">
			<a href="#">
                <iframe 
                    id="videoID" 
                    height="515" 
                    class="w-100" 
                    frameborder="0" 
                    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" 
                    allowfullscreen>
                </iframe>
            </a>
    </figure>
</div>
   </div>
  </div>
  <div class="col-md-8 p-0">
   <div class="play2r  bg_grey p-4">
	   <h3><span class="col_red">The Hottest Movie Right Now:</span> ${phimListHot[0].getTenPhim()}</span><br></h3>
      <h5 class="mt-3">Plot</h5>
	  <hr class="line">
	  <p class="mt-3">${phimListHot[0].getMoTa()}</p>
	  <div class="play2ri row mt-4">
	   <div class="col-md-6">
	    <div class="play2ril">
		 <h6 class="fw-normal">
Duration: <span class="pull-right">${phimListHot[0].getThoiLuong()}m</span></h6>
         <hr class="hr_1">
		  <h6 class="fw-normal">
Genre: <span class="pull-right">							    <c:if test="${not empty phimListHot[0].chiTietTheLoais}">
							        <c:forEach var="chiTiet" items="${phimListHot[0].chiTietTheLoais}" varStatus="status">
							            <c:out value="${chiTiet.theLoai.tenTL}" />
							            <c:if test="${!status.last}">, </c:if>
							        </c:forEach>
							    </c:if></span></h6>
         <hr class="hr_1">
		 <h6 class="fw-normal">
Director: <span class="pull-right">${phimListHot[0].getDaoDien().getTenDaoDien()}</span></h6>
         <hr class="hr_1">
		  <h6 class="fw-normal">
Cast : <span class="pull-right">						    <c:if test="${not empty phimListHot[0].vaiDiens}">
							        <c:forEach var="chiTietdienvien" items="${phimListHot[0].vaiDiens}" varStatus="status">
							            <c:out value="${chiTietdienvien.getDienVien().tenDienVien}" />
							            <c:if test="${!status.last}">, </c:if>
							        </c:forEach>
							    </c:if></span></h6>
         <hr class="hr_1">
		 <h6 class="fw-normal">
Year of Production: <span class="pull-right">${phimListHot[0].getNamSX()}</span></h6>
         <hr class="hr_1 mb-0">
		</div>
	   </div>
	   <div class="col-md-6">
	    <div class="play2rir">
		 <h6 class="fw-normal">Customer Rating: <span class="col_red"><b>${phimListHot[0].getDiem()}</b></span> / 5 <span class="col_red"><i class="fa fa-star"></i></span></h6>
         <div class="progress">
  <div class="progress-bar" role="progressbar" style="width: 100%;" aria-valuenow="25" aria-valuemin="0" aria-valuemax="100"></div>
</div>
          <h6 class="fw-normal mt-3">5-Star Rating<span class="col_red"><i class="fa fa-star"></i></span> - ${thongKeDanhGiaMap[phimListHot[0].maPhim][4]} Customer</h6>
         <div class="progress">
  <div class="progress-bar" role="progressbar" style="width: 100%;" aria-valuenow="25" aria-valuemin="0" aria-valuemax="100"></div>
</div>
          <h6 class="fw-normal mt-3">4-Star Rating<span class="col_red"><i class="fa fa-star"></i></span> - ${thongKeDanhGiaMap[phimListHot[0].maPhim][3]} Customer</h6>
         <div class="progress">
  <div class="progress-bar" role="progressbar" style="width: 80%;" aria-valuenow="25" aria-valuemin="0" aria-valuemax="100"></div>
</div>
          <h6 class="fw-normal mt-3">3-Star Rating<span class="col_red"><i class="fa fa-star"></i></span> - ${thongKeDanhGiaMap[phimListHot[0].maPhim][2]} Customer</h6>
         <div class="progress">
  <div class="progress-bar" role="progressbar" style="width: 60%;" aria-valuenow="25" aria-valuemin="0" aria-valuemax="100"></div>
</div>
        <h6 class="fw-normal mt-3">2-Star Rating<span class="col_red"><i class="fa fa-star"></i></span> - ${thongKeDanhGiaMap[phimListHot[0].maPhim][1]} Customer</h6>
         <div class="progress">
  <div class="progress-bar" role="progressbar" style="width: 40%;" aria-valuenow="25" aria-valuemin="0" aria-valuemax="100"></div>
</div>
		</div>
	   </div>
	  </div>
   </div>
  </div>
 </div>
</div>
</div>
</section>

<section id="choice" class="pt-4 pb-5">
	<div class="container">
 		<div class="row trend_1">
  			<div class="col-md-6 col-6">
   				<div class="trend_1l">
    				<h4 class="mb-0">
    					<i class="fa fa-youtube-play align-middle col_red me-1"></i> 
    					Billion-Dollar  <span class="col_red">Director</span>
    				</h4>
   				</div>
  			</div>
 		</div>
 		<div class="row trend_2 mt-4">
   			<div id="carouselExampleCaptions3" class="carousel slide" data-bs-ride="carousel">
  				<div class="carousel-indicators">
    				<button type="button" data-bs-target="#carouselExampleCaptions3" data-bs-slide-to="0" class="active" aria-label="Slide 1"></button>
    				<button type="button" data-bs-target="#carouselExampleCaptions3" data-bs-slide-to="1" aria-label="Slide 2"></button>
  				</div>
  				<div class="carousel-inner">
			        <c:forEach var="daodien" items="${DaoDienList}" varStatus="status" begin="0" end="5">
			            <c:if test="${status.index % 3 == 0}">
                    		<div class="carousel-item ${status.index == 0 ? 'active' : ''}">
                        		<div class="row trend_2i"> <!-- ƒê·∫£m b·∫£o s·ª≠ d·ª•ng ƒë√∫ng h√†ng -->
			            </c:if>
								<div class="col-md-4">
			  						<div class="trend_2im clearfix position-relative">
		   								<div class="trend_2im1 clearfix">
		   		 							<div class="grid">
		  										<figure class="effect-jazz mb-0">
													<a href="#"><img src="/DoAnWebCinema/uploads/${daodien.anh}" class="w-100" alt="img25"></a>
	  											</figure>
	  										</div>
	   									</div>
			   							<div class="trend_2im2 clearfix position-absolute w-100 top-0">
			     							<h5><a class="col_red" href="#">${daodien.getTenDaoDien()}</a></h5>
											<span class="col_red">
												<i class="fa fa-star"></i>
												<i class="fa fa-star"></i>
												<i class="fa fa-star"></i>
												<i class="fa fa-star"></i>
												<i class="fa fa-star"></i>
											</span>
			   							</div>
	  								 </div>
	 								</div>
			 				<c:if test="${status.index % 3 == 2 || status.last}">
				                </div> <!-- ƒê√≥ng h√†ng ·ªü ƒë√¢y -->
				            </div> <!-- ƒê√≥ng carousel-item ·ªü ƒë√¢y -->
				        </c:if>
				    </c:forEach>
  				</div>
			</div>
		</div>
	</div>
</section>

<section id="footer">
 <div class="footer_m clearfix">
  <div class="container">
   <div class="row footer_1">
    <div class="col-md-4">
     <div class="footer_1i">
      <h3><a class="text-white" href="lienhe.htm"><i class="fa fa-video-camera col_red me-1"></i> <span class="col_red">Contact</span></a></h3>
       <p class="mt-3">Tu Tru. Where Emotions Converge.</p>
       <h6 class="fw-normal"><i class="fa fa-map-marker fs-5 align-middle col_red me-1"></i>97 Man Thi·ªán St., Hi·ªáp Ph√∫, Th·ªß ƒê·ª©c, Ho Chi Minh City, Vietnam</h6>
       <h6 class="fw-normal mt-3"><i class="fa fa-envelope fs-5 align-middle col_red me-1"></i> tutrucinema@gmail.com</h6>
       <h6 class="fw-normal mt-3 mb-0"><i class="fa fa-phone fs-5 align-middle col_red me-1"></i>  1900 0099</h6>
     </div>
    </div>
   <div class="col-md-4">
    <div class="footer_1i">
     <h4><span class="col_red">Newsletter</span></h4>
      <p class="mt-3">Subscribe to our newsletter to receive the latest news and updates from us.</p>
       <div class="input-group">
        <input type="text" class="form-control bg-black" placeholder="Email">
         <span class="input-group-btn">
          <button class="btn btn text-white bg_red rounded-0 border-0" type="button">Sign Up</button>
         </span>
        </div>
       </div>
      </div>
  <div class="col-md-4">
    <div class="footer_1i text-center">
        <h4 class="mb-4"> <span class="col_red">Connect with Us</span></h4>
        <div class="footer_1i1">
            <ul class="social-network social-square mb-0 mt-4">
                <li class=""><a href="https://www.facebook.com/profile.php?id=100018102729044"><img  src="images/icon-facebook.png" height="50" title="Facebook" alt="Facebook"></a></li>
                <li class=""><a href=""><img  src="images/icon-instagram.png" height="50" title="Instagram" alt="Instagram"></a></li>
                <li class=""><a href=""><img  src="images/icon-tiktok.png" height="50" title="Tiktok" alt="Tiktok"></a></li>
                <li class=""><a href=""><img  src="images/icon-youtube.png" height="50" title="Youtube" alt="Youtube"></a></li>
            </ul>
        </div>
        <div class="footer_1i1 mt-3">
            <a href="http://online.gov.vn/HomePage/CustomWebsiteDisplay.aspx?DocId=30278" target="_blank">
                <img src="images/icon-bocongthuong.png" height="80" alt="abc">
            </a>
        </div>
       </div>
      </div>
     </div>
    </div>
   </div>
</section>

<section id="footer_b" class="pt-3 pb-3 bg_grey">
<div class="container">
   <div class="row footer_1 text-center">
	   <p class="mb-0">¬© 2024 Tu Tru Cinema. All Rights Reserved</p>
   </div>
</div>
</section>

<!-- Chatbox Icon -->
<div class="chatbox-icon" onclick="openModal()">
	<div id="greeting" class="greeting-message">
	    <b>AI Tu Tru is always ready to assist!</b>
	</div>
    <div class="chat-icon">
        <img src="/DoAnWebCinema/images/chatboxicon.gif" alt="Chat Icon">
    </div>
</div>

<!-- Modal -->
<div id="chatModal" class="modal">
    <!-- Modal Content -->
    <div class="modal-content">
		<div class="modal-header">
		    <div class="header-left">
		        <img src="http://localhost:9999/DoAnWebCinema/images/logocinema.png" alt="Tu Tru Cinema Logo" class="logo-icon" />
		        <div class="brand-text">
		            <span class="cinema-name"><b>Tu Tru Cinema</b></span>
		            <span class="subtitle">Online Customer Support</span>
		        </div>
		    </div>
		    <button class="close-btn" onclick="closeModal()">&times;</button>
		</div>
<!-- 		<div class="scrolling-message">
            <p style="color: black;">Welcome to our support system. We are always ready to assist you with any questions.</p>
        </div> -->
        <div class="modal-body">
            <div id="chat-content">
                <!-- Dynamic chat messages will be appended here -->
            </div>
        </div>
        <div class="modal-footer">
            <input type="text" id="chat-input" placeholder="Enter message..." />
            <input type="hidden" id="user-id" value="${user.maKH}">
            <button id="send-btn">Send</button>
        </div>
    </div>
</div>

<script>
//M·ªü modal chat
function openModal() {
    document.getElementById('chatModal').style.display = 'flex';
}

// ƒê√≥ng modal chat
function closeModal() {
    document.getElementById('chatModal').style.display = 'none';
}

//Danh s√°ch g·ª£i √Ω ng·∫´u nhi√™n
const suggestions = {
    notLoggedIn: [
        { text: "The movie <b><c:out value='${phimBanChayNhat[1]}'/></b> is really hot right now! Should we book tickets?", tag: "Book tickets for the movie <c:out value="${phimBanChayNhat[1] != null ? phimBanChayNhat[1].toLowerCase() : ''}" />" },
    ],
    loggedIn: [
        { text: "Would you like to check out my surprise?", tag: "Suggest a movie" },
        { text: "You might love my suggestion üòé", tag: "Suggest a movie" },
        { text: "The movie <b><c:out value='${phimBanChayNhat[1]}'/></b> is really hot right now, should we book tickets?", tag: "Booking ticket <c:out value="${phimBanChayNhat[1] != null ? phimBanChayNhat[1].toLowerCase() : ''}" />" }
    ]
};
let usedTags = [];

// Ki·ªÉm tra tr·∫°ng th√°i ƒëƒÉng nh·∫≠p
function isLoggedIn() {
    const userId = document.getElementById('user-id').value;
    return userId !== ""; // Gi·∫£ s·ª≠ userId r·ªóng nghƒ©a l√† ch∆∞a ƒëƒÉng nh·∫≠p
}

//L·∫•y m·ªôt g·ª£i √Ω kh√¥ng tr√πng l·∫∑p
function getRandomSuggestion(isUserLoggedIn) {
    const pool = isUserLoggedIn ? suggestions.loggedIn : suggestions.notLoggedIn;

    // L·ªçc ra c√°c g·ª£i √Ω ch∆∞a s·ª≠ d·ª•ng
    const availableSuggestions = pool.filter(suggestion => !usedTags.includes(suggestion.tag));

    // N·∫øu kh√¥ng c√≤n g·ª£i √Ω m·ªõi, l√†m m·ªõi danh s√°ch ƒë√£ s·ª≠ d·ª•ng
    if (availableSuggestions.length === 0) {
        usedTags = [];
        return getRandomSuggestion(isUserLoggedIn);
    }

    // Ch·ªçn ng·∫´u nhi√™n m·ªôt g·ª£i √Ω t·ª´ danh s√°ch c√≤n l·∫°i
    const randomIndex = Math.floor(Math.random() * availableSuggestions.length);
    const selectedSuggestion = availableSuggestions[randomIndex];

    // Th√™m tag v√†o danh s√°ch ƒë√£ s·ª≠ d·ª•ng
    usedTags.push(selectedSuggestion.tag);

    return selectedSuggestion;
}
//T·∫°o g·ª£i √Ω v√† hi·ªÉn th·ªã trong 15 gi√¢y
function displaySuggestion() {
    const isUserLoggedIn = isLoggedIn();
    const randomSuggestion = isUserLoggedIn
        ? suggestions.loggedIn[Math.floor(Math.random() * suggestions.loggedIn.length)]
        : suggestions.notLoggedIn[Math.floor(Math.random() * suggestions.notLoggedIn.length)];

    const greetingElement = document.getElementById('greeting');

    // Hi·ªÉn th·ªã g·ª£i √Ω
    greetingElement.innerHTML = randomSuggestion.text;
    greetingElement.classList.add('show'); // Th√™m class "show" ƒë·ªÉ hi·ªÉn th·ªã
	
    greetingElement.onclick = function () {
    	 sendMessage(randomSuggestion.tag);
    };
    
    // ·∫®n sau 15 gi√¢y
    setTimeout(() => {
        greetingElement.classList.remove('show'); // G·ª° class "show" ƒë·ªÉ ·∫©n
    }, 15000); // 15 gi√¢y
}

// L·∫∑p l·∫°i hi·ªÉn th·ªã g·ª£i √Ω sau m·ªói 3 ph√∫t
setInterval(displaySuggestion, 30000); // 3 ph√∫t
displaySuggestion(); // Hi·ªÉn th·ªã ngay l·∫ßn ƒë·∫ßu ti√™n


function sendMessage(tag) {
    const input = document.getElementById('chat-input');
    const message = tag ? tag : input.value.trim();
    const userId = document.getElementById('user-id').value; // L·∫•y user_id t·ª´ hidden input

    if (message) {
        const chatContent = document.getElementById('chat-content');

        // Hi·ªÉn th·ªã tin nh·∫Øn c·ªßa ng∆∞·ªùi d√πng
        const userMessage = document.createElement('div');
        userMessage.classList.add('chat-message', 'user-message');

        const messageContent = document.createElement('div');
        messageContent.classList.add('message-content');
        messageContent.textContent = message;

        userMessage.appendChild(messageContent);
        chatContent.appendChild(userMessage);

        // T·ª± ƒë·ªông cu·ªôn xu·ªëng d∆∞·ªõi
        chatContent.scrollTop = chatContent.scrollHeight;

        input.value = '';

        // G·ª≠i tin nh·∫Øn c√πng user_id ƒë·∫øn chatbot Python qua API Flask
        fetch('http://127.0.0.1:5000/handle_message', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ message: message, user_id: userId }),
        })
            .then(response => response.json())
            .then(data => {
                // Hi·ªÉn th·ªã ph·∫£n h·ªìi t·ª´ chatbot
                const botMessage = document.createElement('div');
                botMessage.classList.add('chat-message', 'bot-message');

                const botMessageContent = document.createElement('div');
                botMessageContent.classList.add('message-content');
                botMessageContent.innerHTML = data.response;

                botMessage.appendChild(botMessageContent);
                chatContent.appendChild(botMessage);

                // T·ª± ƒë·ªông cu·ªôn xu·ªëng d∆∞·ªõi
                chatContent.scrollTop = chatContent.scrollHeight;
            })
            .catch(error => {
                console.error('Error when calling Flask API:', error);
            });
    }
}


// S·ª± ki·ªán nh·∫•n n√∫t G·ª≠i
document.getElementById('send-btn').addEventListener('click', sendMessage);

// S·ª± ki·ªán nh·∫•n ph√≠m Enter
document.getElementById('chat-input').addEventListener('keydown', function (event) {
    if (event.key === 'Enter') {
        event.preventDefault(); // NgƒÉn h√†nh vi m·∫∑c ƒë·ªãnh
        sendMessage();
    }
});

</script>
<script>
window.onscroll = function() {myFunction()};

var navbar_sticky = document.getElementById("navbar_sticky");
var sticky = navbar_sticky.offsetTop;
var navbar_height = document.querySelector('.navbar').offsetHeight;

function myFunction() {
  if (window.pageYOffset >= sticky + navbar_height) {
    navbar_sticky.classList.add("sticky")
	document.body.style.paddingTop = navbar_height + 'px';
  } else {
    navbar_sticky.classList.remove("sticky");
	document.body.style.paddingTop = '0'
  }
}

function openLightbox(linkTrailer, lightboxId, videoId) {
    document.getElementById(lightboxId).style.display = 'flex';  // Hi·ªÉn th·ªã lightbox
    document.getElementById(videoId).src = linkTrailer.replace("watch?v=", "embed/") + "?autoplay=1&mute=1";  // Nh√∫ng video YouTube
}

function closeLightbox(lightboxId, videoId) {
    document.getElementById(lightboxId).style.display = 'none';  // ·∫®n lightbox
    document.getElementById(videoId).src = '';  // D·ª´ng video b·∫±ng c√°ch x√≥a src
}


</script>
<script>
    // L·∫•y link trailer t·ª´ database (·ªü ƒë√¢y l√† t·ª´ phimListHot)
    var originalLink = "${phimListHot[0].getLinkTrailer()}"; // V√≠ d·ª•: https://www.youtube.com/watch?v=dQw4w9WgXcQ

    // Chuy·ªÉn ƒë·ªïi link th√†nh d·∫°ng nh√∫ng
    var embedLink = originalLink.replace("watch?v=", "embed/");

    // Thi·∫øt l·∫≠p l·∫°i link cho iframe
    document.getElementById("videoID").src = embedLink + "?autoplay=1&mute=1";
</script>


<script>
    // L·∫•y ng√†y hi·ªán t·∫°i
    var curDate = new Date();
    var date = curDate.getDate();
    var month = curDate.getMonth() + 1; // Th√°ng b·∫Øt ƒë·∫ßu t·ª´ 0
    var year = curDate.getFullYear();

    // ƒê·ªãnh d·∫°ng ng√†y theo ƒë·ªãnh d·∫°ng yyyy-mm-dd
    var formattedDate = year + '-' + (month < 10 ? '0' + month : month) + '-' + (date < 10 ? '0' + date : date);

    // C·∫≠p nh·∫≠t li√™n k·∫øt href
    var link = document.getElementById('dat-ve-link');
    if (link) { // Ki·ªÉm tra xem ph·∫ßn t·ª≠ c√≥ t·ªìn t·∫°i kh√¥ng
        link.href = '/DoAnWebCinema/datve/' + formattedDate + '.htm?chinhanh=1';
    }
</script>

<script>
    document.addEventListener("DOMContentLoaded", function() {
        // L·∫•y t·∫•t c·∫£ c√°c m·ª•c trong menu
        const menuItems = document.querySelectorAll('.navbar-nav .nav-item a');
        
        // L·∫•y ƒë∆∞·ªùng d·∫´n c·ªßa trang hi·ªán t·∫°i
        const currentPath = window.location.pathname;

        // Duy·ªát qua t·ª´ng m·ª•c menu
        menuItems.forEach(function(item) {
            // Ki·ªÉm tra n·∫øu href c·ªßa m·ª•c menu tr√πng v·ªõi ƒë∆∞·ªùng d·∫´n hi·ªán t·∫°i
            if (item.getAttribute('href') === currentPath) {
                // Th√™m l·ªõp active v√†o m·ª•c menu
                item.classList.add('active');
            } else {
                // Lo·∫°i b·ªè l·ªõp active kh·ªèi c√°c m·ª•c menu kh√°c
                item.classList.remove('active');
            }
        });
    });
</script>

</body>

</html>